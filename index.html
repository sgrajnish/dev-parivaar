<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Dev Parivaar</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#020617;color:#e5e7eb}
    header{position:sticky;top:0;display:flex;align-items:center;gap:10px;background:#020617;padding:12px 14px;border-bottom:1px solid #0f172a;font-weight:800}
    .hamburger{font-size:24px;cursor:pointer}
    main{padding:12px 12px 96px;max-width:900px;margin:0 auto}
    .group{margin-bottom:14px}
    .group h3{margin:10px 0;padding:8px 12px;border-radius:10px;color:#020617;font-weight:900}
    .g-blue{background:#7dd3fc}.g-green{background:#86efac}.g-yellow{background:#fde047}.g-orange{background:#fb923c}.g-red{background:#ef4444}.g-white{background:#fff}.g-grey{background:#e5e7eb}
    .card{background:#0b1220;border:1px solid #0f172a;border-radius:14px;padding:12px;margin:8px 0}
    .name{font-weight:900}
    .meta{color:#94a3b8}
    .fab{position:fixed;right:16px;bottom:16px;width:64px;height:64px;border-radius:50%;border:none;font-size:34px;background:#22c55e;color:#052e16}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none}
    .overlay.show{display:block}
    .sheet{position:fixed;left:0;right:0;bottom:0;background:#020617;border-radius:18px 18px 0 0;padding:12px;transform:translateY(110%);transition:.2s;max-height:90vh;overflow:auto}
    .sheet.show{transform:translateY(0)}
    .field{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #0f172a;background:#0b1220;color:#e5e7eb}
    .btn{width:100%;padding:12px;border-radius:10px;border:none;background:#22c55e;color:#052e16;font-weight:900}
    .drawer{position:fixed;top:0;left:0;bottom:0;width:260px;background:#020617;border-right:1px solid #0f172a;transform:translateX(-110%);transition:.2s;padding:12px}
    .drawer.show{transform:translateX(0)}
    .item{padding:10px;border-radius:8px;cursor:pointer}
    .item:hover{background:#0b1220}
    .badge{background:#fb923c;color:#fff;font-weight:900;border-radius:999px;padding:4px 8px}
    .toast{position:fixed;left:50%;bottom:90px;transform:translateX(-50%);background:#22c55e;color:#052e16;padding:8px 12px;border-radius:8px;font-weight:900;display:none}
    .toast.show{display:block}
  </style>
</head>
<body>
  <div id="drawer" class="drawer">
    <div class="item" id="totalBox"></div>
    <div class="item" onclick="openProfile()">My Profile</div>
    <div class="item" onclick="openEdit()">Edit Profile</div>
    <div class="item" onclick="logout()">Logout</div>
  </div>
  <div id="drawerOverlay" class="overlay" onclick="closeDrawer()"></div>

  <header>
    <div class="hamburger" onclick="toggleDrawer()">☰</div>
    <div>Dev Parivaar</div>
  </header>

  <main id="groups">Loading…</main>

  <button class="fab" onclick="toggleSheet()">＋</button>
  <div id="sheetOverlay" class="overlay" onclick="closeSheet()"></div>

  <section id="sheet" class="sheet">
    <h3 id="sheetTitle">Add / Edit My Details</h3>
    <input id="UserID" class="field" disabled />
    <input id="Name" class="field" placeholder="Name" />
    <input id="Mobile" class="field" placeholder="Mobile" />
    <input id="DOB" class="field" placeholder="D.O.B" />
    <select id="Group" class="field">
      <option>BISHUDDHI</option><option>ANAHAT</option><option>MANIPUR</option>
      <option>SWADISTHAN</option><option>MULADHAR</option><option>NANDI</option><option>SAHAJA</option>
    </select>
    <input id="State" class="field" placeholder="State" />
    <input id="District" class="field" placeholder="District" />
    <input id="Block" class="field" placeholder="Block" />
    <input id="GPWard" class="field" placeholder="GP/Ward" />
    <input id="VillageTown" class="field" placeholder="Village/Town" />
    <button class="btn" onclick="save()">Save</button>
  </section>

  <div id="toast" class="toast"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzVSks1rUQSQQrnplpyd3hFFoWd8VNnY2y4Faf5O0p6c3vXLr_V_AWBqLvgqlHh6PNGJw/exec";
    const PIN = "7391";

    let UID = localStorage.getItem("DP_UID");
    if(!UID){ UID = "DP-"+Date.now().toString(36)+Math.random().toString(36).slice(2,6); localStorage.setItem("DP_UID", UID); }
    UserID.value = UID;

    let ALL = [];

    function toast(msg){ const t=toastEl; t.innerText=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1500); }

    function toggleDrawer(){ drawer.classList.toggle("show"); drawerOverlay.classList.toggle("show"); }
    function closeDrawer(){ drawer.classList.remove("show"); drawerOverlay.classList.remove("show"); }

    function toggleSheet(){ sheet.classList.toggle("show"); sheetOverlay.classList.toggle("show"); }
    function closeSheet(){ sheet.classList.remove("show"); sheetOverlay.classList.remove("show"); }

    async function load(){
      const r = await fetch(API_URL+"?action=list");
      ALL = await r.json();
      totalBox.innerHTML = `Total Members <span class="badge">${ALL.length}</span>`;
      ALL.sort((a,b)=>(a["Name"]||"").localeCompare(b["Name"]||""));
      const groups = {BISHUDDHI:[],ANAHAT:[],MANIPUR:[],SWADISTHAN:[],MULADHAR:[],NANDI:[],SAHAJA:[]};
      ALL.forEach(m=>{ const g=(m["Group"]||"").toUpperCase(); if(groups[g]) groups[g].push(m); });
      groupsEl.innerHTML = `
        ${render("BISHUDDHI","g-blue",groups.BISHUDDHI)}
        ${render("ANAHAT","g-green",groups.ANAHAT)}
        ${render("MANIPUR","g-yellow",groups.MANIPUR)}
        ${render("SWADISTHAN","g-orange",groups.SWADISTHAN)}
        ${render("MULADHAR","g-red",groups.MULADHAR)}
        ${render("NANDI","g-white",groups.NANDI)}
        ${render("SAHAJA","g-grey",groups.SAHAJA)}
      `;
    }

    function render(title,cls,arr){
      return `<div class="group"><h3 class="${cls}">${title}</h3>` +
        (arr.map(m=>`
          <div class="card">
            <div class="name">${m["Name"]||""}</div>
            <div class="meta">${m["State"]||""}, ${m["District"]||""}, ${m["Block"]||""}, ${m["GP/Ward"]||""}, ${m["Village/Town"]||""}</div>
          </div>`).join("") || `<div class="meta">No members</div>`) + `</div>`;
    }

    function openProfile(){
      closeDrawer();
      const me = ALL.find(m=>m["User ID"]===UID);
      if(!me){ toast("No profile found"); return; }
      Name.value=me["Name"]||""; Mobile.value=me["Mobile"]||""; DOB.value=me["D.O.B"]||""; Group.value=me["Group"]||"";
      State.value=me["State"]||""; District.value=me["District"]||""; Block.value=me["Block"]||""; GPWard.value=me["GP/Ward"]||""; VillageTown.value=me["Village/Town"]||"";
      toggleSheet();
    }

    function openEdit(){ openProfile(); }

    async function save(){
      const payload = {
        "User ID": UID,"Name":Name.value,"Mobile":Mobile.value,"D.O.B":DOB.value,"Group":Group.value,
        "State":State.value,"District":District.value,"Block":Block.value,"GP/Ward":GPWard.value,"Village/Town":VillageTown.value
      };
      const r = await fetch(API_URL, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload), mode:"cors", credentials:"omit" });
      if(r.ok){ closeSheet(); await load(); toast("SAVED SUCCESSFULLY"); }
      else { toast("SAVE FAILED"); }
    }

    const groupsEl = document.getElementById("groups");
    const toastEl = document.getElementById("toast");
    load();
  </script>
</body>
</html>


